/* Based on http://www.thomasfrank.se/sessionvars.html */
jsess=function(){var x={};x.$={prefs:{memLimit:2e3,autoFlush:true,crossDomain:false,includeProtos:false,includeFunctions:false},parent:x,clearMem:function(){for(var a in this.parent){if(a!="$"){this.parent[a]=undefined}}this.flush()},usedMem:function(){x={};return Math.round(this.flush(x)/1024)},usedMemPercent:function(){return Math.round(this.usedMem()/this.prefs.memLimit)},flush:function(a){var b,c={},d=this.$$;a=a||top;for(var e in this.parent){c[e]=this.parent[e]}c.$=this.prefs;d.includeProtos=this.prefs.includeProtos;d.includeFunctions=this.prefs.includeFunctions;b=this.$$.make(c);if(a!=top){return b.length}if(b.length/1024>this.prefs.memLimit){return false}a.name=b;return true},getDomain:function(){var a=location.href;a=a.split("///").join("//");a=a.substring(a.indexOf("://")+3).split("/")[0];while(a.split(".").length>2){a=a.substring(a.indexOf(".")+1)}return a},debug:function(a){var a=a||this,b=arguments.callee;if(!document.body){setTimeout(function(){b(a)},200);return}a.flush();var c=document.getElementById("jsessDebug");if(!c){c=document.createElement("div");document.body.insertBefore(c,document.body.firstChild)}c.id="jsessDebug";c.innerHTML='<div style="line-height:20px;padding:5px;font-size:11px;font-family:Verdana,Arial,Helvetica;'+'z-index:10000;background:#FFFFCC;border: 1px solid #333;margin-bottom:12px">'+'<b style="font-family:Trebuchet MS;font-size:20px">jsess.js - debug info:</b><br/><br/>'+"Memory usage: "+a.usedMem()+" Kb ("+a.usedMemPercent()+"%)   "+'<span style="cursor:pointer"><b>[Clear memory]</b></span><br/>'+top.name.split("\n").join("<br/>")+"</div>";c.getElementsByTagName("span")[0].onclick=function(){a.clearMem();location.reload()}},init:function(){var a={},b=this;try{a=this.$$.toObject(top.name)}catch(c){a={}}this.prefs=a.$||b.prefs;if(this.prefs.crossDomain||this.prefs.currentDomain==this.getDomain()){for(var d in a){this.parent[d]=a[d]}}else{this.prefs.currentDomain=this.getDomain()}this.parent.$=b;b.flush();var e=function(){if(b.prefs.autoFlush){b.flush()}};if(window["addEventListener"]){addEventListener("unload",e,false)}else if(window["attachEvent"]){window.attachEvent("onunload",e)}else{this.prefs.autoFlush=false}}};x.$.$$={compactOutput:false,includeProtos:false,includeFunctions:false,detectCirculars:true,restoreCirculars:true,make:function(a,b){this.restore=b;this.mem=[];this.pathMem=[];return this.toJsonStringArray(a).join("")},toObject:function(x){if(!this.cleaner){try{this.cleaner=new RegExp('^("(\\\\.|[^"\\\\\\n\\r])*?"|[,:{}\\[\\]0-9.\\-+Eaeflnr-u \\n\\r\\t])+?$')}catch(a){this.cleaner=/^(true|false|null|\[.*\]|\{.*\}|".*"|\d+|\d+\.\d+)$/}}if(!this.cleaner.test(x)){return{}}eval("this.myObj="+x);if(!this.restoreCirculars||!alert){return this.myObj}if(this.includeFunctions){var x=this.myObj;for(var i in x){if(typeof x[i]=="string"&&!x[i].indexOf("JSONincludedFunc:")){x[i]=x[i].substring(17);eval("x[i]="+x[i])}}}this.restoreCode=[];this.make(this.myObj,true);var r=this.restoreCode.join(";")+";";eval('r=r.replace(/\\W([0-9]{1,})(\\W)/g,"[$1]$2").replace(/\\.\\;/g,";")');eval(r);return this.myObj},toJsonStringArray:function(a,b){if(!b){this.path=[]}b=b||[];var c;switch(typeof a){case"object":this.lastObj=a;if(this.detectCirculars){var d=this.mem;var e=this.pathMem;for(var f=0;f<d.length;f++){if(a===d[f]){b.push('"JSONcircRef:'+e[f]+'"');return b}}d.push(a);e.push(this.path.join("."))}if(a){if(a.constructor==Array){b.push("[");for(var f=0;f<a.length;++f){this.path.push(f);if(f>0)b.push(",\n");this.toJsonStringArray(a[f],b);this.path.pop()}b.push("]");return b}else if(typeof a.toString!="undefined"){b.push("{");var g=true;for(var f in a){if(!this.includeProtos&&a[f]===a.constructor.prototype[f]){continue}this.path.push(f);var h=b.length;if(!g)b.push(this.compactOutput?",":",\n");this.toJsonStringArray(f,b);b.push(":");this.toJsonStringArray(a[f],b);if(b[b.length-1]==c)b.splice(h,b.length-h);else g=false;this.path.pop()}b.push("}");return b}return b}b.push("null");return b;case"unknown":case"undefined":case"function":if(!this.includeFunctions){b.push(c);return b}a="JSONincludedFunc:"+a;b.push('"');var i=["\n","\\n","\r","\\r",'"','\\"'];a+="";for(var f=0;f<6;f+=2){a=a.split(i[f]).join(i[f+1])}b.push(a);b.push('"');return b;case"string":if(this.restore&&a.indexOf("JSONcircRef:")==0){this.restoreCode.push("this.myObj."+this.path.join(".")+"="+a.split("JSONcircRef:").join("this.myObj."))}b.push('"');var i=["\n","\\n","\r","\\r",'"','\\"'];a+="";for(var f=0;f<6;f+=2){a=a.split(i[f]).join(i[f+1])}b.push(a);b.push('"');return b;default:b.push(String(a));return b}}};x.$.init();return x}();
